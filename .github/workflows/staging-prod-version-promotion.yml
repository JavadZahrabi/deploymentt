
name: staging-prod-version-promotion

on:
  push:
    branches: [ "master" ]
    paths:
      - 'envs/staging/version.yml'

jobs:

  promote-version:
    runs-on: ubuntu-latest
    name: Promote version from dev to staging

    steps:
    
        - name: Checkout Deployment repository
          uses: actions/checkout@v3
          with:
            repository: JavadZahrabi/deployment
            path: ./deployment

        - name: copy version.yml
          run: |
              cp -R ./deployment/envs/staging/version.yml ./deployment/envs/prod
        - name: Push version to prod
          run: |
            cd ./deployment
            git checkout -b "prod"
            git add .
            git config user.name JavadZahrabi
            git config user.email ja.zahrabi@gmail.com
            git commit -am "version.yml promoted from staging to prod"
            git push --set-upstream -f origin prod